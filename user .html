<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exchanger Pro - Trusted Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        :root { --primary: #2c3e50; --success: #27ae60; --danger: #e74c3c; --whatsapp: #25D366; --telegram: #0088cc; --warning: #f39c12; }
        body { background-color: #f0f2f5; font-family: 'Segoe UI', sans-serif; padding-bottom: 80px; }
        .price-badge { background: #fff; border-left: 5px solid var(--success); border-radius: 8px; padding: 15px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .nav-bottom { position: fixed; bottom: 0; width: 100%; background: #fff; border-top: 1px solid #ddd; display: flex; justify-content: space-around; padding: 8px 0; z-index: 1000; }
        .nav-item { text-align: center; color: #7f8c8d; text-decoration: none; font-size: 11px; cursor: pointer; transition: 0.3s; flex: 1; }
        .nav-item.active { color: var(--success); transform: scale(1.05); }
        .content-section { display: none; padding: 15px; animation: fadeIn 0.4s; }
        .content-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* Floating Buttons */
        .social-float { position: fixed; bottom: 90px; right: 20px; display: flex; flex-direction: column; gap: 10px; z-index: 1000; }
        .float-btn { width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 26px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); text-decoration: none; color: white; transition: transform 0.2s; }
        .float-btn:hover { transform: scale(1.1); }
        .wa-btn { background-color: var(--whatsapp); }
        .tg-btn { background-color: var(--telegram); }

        .balance-card { background: linear-gradient(45deg, #1a2a6c, #b21f1f); color: white; border-radius: 15px; padding: 25px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .trust-box { background: #fff; border-radius: 12px; padding: 15px; margin-top: 20px; border: 1px solid #e0e0e0; }
        .history-list-item { border-bottom: 1px solid #eee; padding: 10px 0; font-size: 13px; }
        .history-list-item:last-child { border-bottom: none; }
        
        /* Stats Box */
        .stats-box { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .stat-card { background: #fff; padding: 10px; border-radius: 8px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid #eee; }
        .stat-card h6 { margin: 0; font-size: 18px; font-weight: bold; }
        .stat-card small { color: #777; font-size: 11px; }

        /* Referral Box */
        .refer-box { background: #fff; border: 1px dashed var(--success); padding: 15px; border-radius: 12px; text-align: center; margin-bottom: 20px; position: relative; overflow: hidden; }
        .refer-box h6 { color: var(--success); font-weight: bold; }
        .refer-code { background: #f0f2f5; padding: 8px; border-radius: 5px; font-family: monospace; font-size: 18px; letter-spacing: 2px; font-weight: bold; display: inline-block; margin: 10px 0; border: 1px solid #ddd; }

        #auth-page { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #f0f2f5; z-index: 2000; padding: 20px; overflow-y: auto; }
        .auth-card { max-width: 400px; margin: 40px auto; background: #fff; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
    </style>
</head>
<body>

<div id="auth-page">
    <div class="auth-card">
        <div id="login-form">
            <h4 class="text-center fw-bold mb-4">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h4>
            <input type="email" id="loginEmail" class="form-control mb-3" placeholder="‡¶ú‡¶ø‡¶Æ‡ßá‡¶á‡¶≤ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡ßç‡¶∞‡ßá‡¶∏">
            <input type="password" id="loginPass" class="form-control mb-3" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°">
            <button class="btn btn-primary w-100 py-2 mb-3" onclick="handleLogin()">Login</button>
            <p class="text-center small">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶®‡ßá‡¶á? <a href="#" onclick="toggleAuth('reg')">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</a></p>
            <button class="btn btn-light w-100 btn-sm" onclick="hideAuth()">‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®</button>
        </div>
        <div id="reg-form" style="display: none;">
            <h4 class="text-center fw-bold mb-4">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶®</h4>
            <input type="text" id="regName" class="form-control mb-3" placeholder="‡¶™‡ßÅ‡¶∞‡ßã ‡¶®‡¶æ‡¶Æ">
            <input type="email" id="regEmail" class="form-control mb-3" placeholder="‡¶Ü‡¶∏‡¶≤ ‡¶ú‡¶ø‡¶Æ‡ßá‡¶á‡¶≤">
            <input type="password" id="regPass" class="form-control mb-3" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° (‡ß¨+ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ/‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞)">
            <input type="password" id="regConfirmPass" class="form-control mb-3" placeholder="‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°">
            <button class="btn btn-success w-100 py-2 mb-3" onclick="handleRegister()">Register Account</button>
            <p class="text-center small">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶Ü‡¶õ‡ßá? <a href="#" onclick="toggleAuth('login')">‡¶≤‡¶ó‡¶á‡¶®</a></p>
        </div>
    </div>
</div>

<div class="social-float">
    <a href="https://t.me/gmail_marketing02" target="_blank" class="float-btn tg-btn"><i class="bi bi-telegram"></i></a>
    <a href="https://wa.me/8801964182265?text=Hello%20I%20need%20support" target="_blank" class="float-btn wa-btn"><i class="bi bi-whatsapp"></i></a>
</div>

<nav class="navbar navbar-dark sticky-top" style="background: var(--primary);">
    <div class="container text-center">
        <span class="navbar-brand mx-auto fw-bold"><i class="bi bi-shield-check text-success"></i> EXCHANGER PRO</span>
    </div>
</nav>

<div class="container mt-3">
    
    <!-- HOME PAGE -->
    <div id="home" class="content-section active">
        <div class="alert alert-info py-2 shadow-sm border-0" style="font-size: 13px;">
            <i class="bi bi-patch-check-fill text-primary"></i> <b>‡ßß‡ß¶‡ß¶% ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶¶:</b> ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶∏‡¶§‡¶§‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶¶‡¶ø‡¶ö‡ßç‡¶õ‡¶ø‡•§
        </div>
        
        <div class="price-badge d-flex justify-content-between align-items-center">
            <div>
                <h6 class="mb-1 text-muted">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∞‡ßá‡¶ü</h6>
                <div class="fw-bold text-dark">
                    <span class="badge bg-success" id="newRateLabel">New: ‡ßß‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</span>
                    <span class="badge bg-primary" id="oldRateLabel">Old: ‡ßÆ ‡¶ü‡¶æ‡¶ï‡¶æ</span>
                </div>
            </div>
            <i class="bi bi-graph-up-arrow fs-3 text-success"></i>
        </div>
        
        <div class="card p-4 border-0 shadow-sm">
            <h5 class="mb-4">‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</h5>
            <div class="mb-3">
                <label class="form-label">‡¶ú‡¶ø‡¶Æ‡ßá‡¶á‡¶≤ ‡¶ß‡¶∞‡¶®</label>
                <select class="form-select form-select-lg" id="dollarType" onchange="updateTotal()"></select>
            </div>
            <button class="btn btn-success btn-lg w-100 mt-2" onclick="protectedAction('exchange')">Next Step <i class="bi bi-arrow-right"></i></button>
        </div>

        <!-- Timer Section -->
        <div class="card border-0 shadow-sm mt-3 bg-light">
            <div class="card-body py-3 text-center">
                <div class="d-flex justify-content-center align-items-center gap-2">
                    <i class="bi bi-stopwatch text-danger fs-4"></i>
                    <div>
                        <div class="fw-bold text-dark" id="timerTextDisplay">Review Time: 1-12 Hours</div>
                        <small class="text-muted fw-bold" id="liveClock">00:00:00</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="trust-box shadow-sm">
            <h6 class="fw-bold text-center border-bottom pb-2">‡¶ï‡ßá‡¶® ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶¨‡ßá‡¶õ‡ßá ‡¶®‡¶ø‡¶¨‡ßá‡¶®?</h6>
            <div class="row text-center mt-3 g-2">
                <div class="col-4"><i class="bi bi-lightning-charge text-warning fs-3"></i><p style="font-size: 11px;">‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü</p></div>
                <div class="col-4"><i class="bi bi-lock text-info fs-3"></i><p style="font-size: 11px;">‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶¶ ‡¶°‡¶æ‡¶ü‡¶æ</p></div>
                <div class="col-4"><i class="bi bi-headset text-success fs-3"></i><p style="font-size: 11px;">‡ß®‡ß™/‡ß≠ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</p></div>
            </div>
        </div>
    </div>

    <!-- EXCHANGE STEP -->
    <div id="exchange_step" class="content-section">
        <div class="d-flex align-items-center mb-3">
            <button class="btn btn-sm btn-outline-secondary me-3" onclick="switchTab('home')"><i class="bi bi-chevron-left"></i></button>
            <h5 class="mb-0">‡¶ú‡¶ø‡¶Æ‡ßá‡¶á‡¶≤ ‡¶°‡¶ø‡¶ü‡ßá‡¶á‡¶≤‡¶∏ ‡¶¶‡¶ø‡¶®</h5>
        </div>
        
        <form id="gmailForm">
            <div id="gmailRows">
                <div class="gmail-row p-3 bg-white rounded border mb-2 row-item position-relative">
                    <input type="email" class="form-control mb-2 g-input" placeholder="Real Gmail Address" required>
                    <input type="text" class="form-control p-input" placeholder="Password" required>
                </div>
                <div class="gmail-row p-3 bg-white rounded border mb-2 row-item position-relative">
                    <input type="email" class="form-control mb-2 g-input" placeholder="Real Gmail Address" required>
                    <input type="text" class="form-control p-input" placeholder="Password" required>
                </div>
            </div>
            <button type="button" class="btn btn-outline-primary btn-sm mb-3" onclick="addMoreRow()">+ ‡¶Ü‡¶∞‡¶ì ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <div class="card p-3 mb-3 bg-light border-0 text-center"><p class="mb-0 fw-bold">‡¶Æ‡ßã‡¶ü ‡¶∏‡¶Æ‡ßç‡¶≠‡¶æ‡¶¨‡ßç‡¶Ø ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ: ‡ß≥ <span id="tempTotal">0</span></p></div>
            <div id="masterError" class="alert alert-danger py-2 fw-bold" style="display:none; font-size: 13px;"></div>
            <button type="button" class="btn btn-primary btn-lg w-100 shadow" onclick="validateAndSubmit()">Confirm & Submit</button>
        </form>
    </div>

    <!-- HISTORY PAGE -->
    <div id="history" class="content-section">
        <!-- Broadcast Message Box -->
        <div id="broadcastBox" class="alert alert-warning py-3 shadow-sm border-0 d-flex align-items-center" style="display:none;">
            <i class="bi bi-megaphone-fill me-3 fs-4"></i> 
            <div>
                <small class="d-block text-muted fw-bold">‡¶ú‡¶∞‡ßÅ‡¶∞‡ßÄ ‡¶®‡ßã‡¶ü‡¶ø‡¶∂:</small>
                <span id="broadcastText" class="fw-bold text-dark">No new messages.</span>
            </div>
        </div>

        <h5 class="mb-3 fw-bold">üìã Transaction History</h5>
        <div class="card border-0 shadow-sm">
            <ul class="list-group list-group-flush" id="historyList">
                <li class="list-group-item text-center text-muted py-4">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá...</li>
            </ul>
        </div>
    </div>

    <!-- SELLERS -->
    <div id="sellers" class="content-section">
        <h5 class="mb-3 text-center">üèÜ Top Selling Today</h5>
        <div id="topSellersList"></div>
    </div>

    <!-- PROFILE -->
    <div id="profile" class="content-section">
        <div class="balance-card text-center">
            <div class="mb-1 small"><i class="bi bi-check-circle-fill"></i> <span id="userDisplayName">User</span></div>
            <small class="opacity-75">üí≥ Main Balance</small>
            <h2 class="fw-bold">‡ß≥ <span id="mainBalance">0.00</span></h2>
            <div class="d-flex justify-content-center gap-2 mt-3">
                <button class="btn btn-light btn-sm fw-bold px-3" onclick="toggleWithdraw()">Withdraw</button>
                <button class="btn btn-warning btn-sm fw-bold px-3 text-white" onclick="Swal.fire('‡¶π‡ßã‡¶≤‡ßç‡¶° ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏', '‡¶è‡¶á ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶∞‡¶ø‡¶≠‡¶ø‡¶â‡¶§‡ßá ‡¶Ü‡¶õ‡ßá‡•§ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶è‡¶™‡ßç‡¶∞‡ßÅ‡¶≠ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏‡ßá ‡¶Ø‡ßã‡¶ó ‡¶π‡¶¨‡ßá‡•§', 'info')">Hold: ‡ß≥ <span id="holdBalance">0.00</span></button>
            </div>
        </div>

        <!-- Referral Section -->
        <div class="refer-box shadow-sm">
            <i class="bi bi-gift-fill text-success" style="font-size: 24px;"></i>
            <h6 class="mt-2">Refer & Earn (Lifetime <span id="refPercentText">5%</span>)</h6>
            <small class="text-muted">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶ï‡ßã‡¶° ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶Ü‡ßü ‡¶ï‡¶∞‡ßÅ‡¶®</small>
            <div class="refer-code" id="myReferralCode">LOADING...</div>
            <button class="btn btn-sm btn-outline-success" onclick="copyRefLink()"><i class="bi bi-link-45deg"></i> Copy Link</button>
            
            <div class="row mt-3 text-center">
                <div class="col-6 border-end">
                    <small class="text-muted d-block">‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶Ü‡ßü</small>
                    <span class="fw-bold text-dark">‡ß≥ <span id="referralEarnings">0.00</span></span>
                </div>
                <div class="col-6">
                    <small class="text-muted d-block">‡¶Æ‡ßã‡¶ü ‡¶∞‡ßá‡¶´‡¶æ‡¶∞</small>
                    <span class="fw-bold text-primary" id="totalReferred">0</span>
                </div>
            </div>
        </div>

        <!-- Stats Section -->
        <div class="card p-3 border-0 shadow-sm mb-3">
            <h6 class="fw-bold mb-3 border-bottom pb-2">üìä ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶∂‡¶® ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</h6>
            <div class="stats-box">
                <div class="stat-card">
                    <small>‡¶Æ‡ßã‡¶ü ‡¶ú‡¶ø‡¶Æ‡ßá‡¶á‡¶≤</small>
                    <h6 id="statTotal">0</h6>
                </div>
                <div class="stat-card" style="background: #fff3cd;">
                    <small>Pending</small>
                    <h6 class="text-warning" id="statPending">0</h6>
                </div>
                <div class="stat-card" style="background: #d1e7dd;">
                    <small>Approved</small>
                    <h6 class="text-success" id="statApproved">0</h6>
                </div>
                <div class="stat-card" style="background: #f8d7da;">
                    <small>Rejected</small>
                    <h6 class="text-danger" id="statRejected">0</h6>
                </div>
            </div>
        </div>

        <div class="card p-4 border-0 shadow-sm mb-3">
            <h6><i class="bi bi-telephone text-primary"></i> üìû Payment Number</h6>
            <div class="input-group mb-4">
                <input type="text" class="form-control" id="paymentNumber" placeholder=" bKash / Nagad / Rocket No.">
                <button class="btn btn-dark" onclick="savePaymentNumber()">Save</button>
            </div>
            
            <div id="withdrawArea" style="display: none; border-top: 2px solid #eee; padding-top: 15px;">
                <p class="text-muted small text-center" id="minWithdrawLabel">üí∞ Minimum Withdrawal: 100 BDT</p>
                <div class="mb-3" id="savedPaymentMethodDisplay" style="display:none; font-size:12px; color:var(--success); font-weight:bold;"></div>
                <select class="form-select mb-3" id="withdrawMethod">
                    <option value="">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßá‡¶•‡¶° ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                    <option value="bkash">bKash üí∏  </option>
                    <option value="nagad">Nagad üíµ </option>
                    <option value="binance">Binance ü™ô</option>
                </select>
                <input type="number" class="form-control mb-3" id="withdrawAmount" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" min="1">
                <button class="btn btn-danger w-100" onclick="processWithdraw()">Submit Request</button>
            </div>
            <button class="btn btn-outline-danger w-100 mt-4 btn-sm" onclick="handleLogout()">Logout</button>
        </div>
    </div>

</div>

<div class="nav-bottom shadow">
    <div class="nav-item active" id="home-btn" onclick="switchTab('home')"><i class="bi bi-house-door fs-4"></i><br>Home</div>
    <div class="nav-item" id="history-btn" onclick="protectedAction('history')"><i class="bi bi-clock-history fs-4"></i><br>History</div>
    <div class="nav-item" id="sellers-btn" onclick="switchTab('sellers')"><i class="bi bi-star fs-4"></i><br>Seller</div>
    <div class="nav-item" id="profile-btn" onclick="protectedAction('profile')"><i class="bi bi-person fs-4"></i><br>Profile</div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import { getDatabase, ref, set, get, update, push, onValue, query, orderByChild, equalTo, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAbsa0uvBYhkEYoLxuHwD4TQi5GDdAzQpg",
    authDomain: "exchanger-pro.firebaseapp.com",
    databaseURL: "https://exchanger-pro-default-rtdb.firebaseio.com",
    projectId: "exchanger-pro",
    storageBucket: "exchanger-pro.firebasestorage.app",
    messagingSenderId: "889959520630",
    appId: "1:889959520630:web:f4cbf82f236b616e1f8257",
    measurementId: "G-KBJJNKZPZD"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);

  window.currentUser = null;
  const urlParams = new URLSearchParams(window.location.search);
  const referrerCode = urlParams.get('ref');

  // ‡ßß. ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
  onValue(ref(db, "settings"), (snap) => {
    if (snap.exists()) {
      const data = snap.val();
      
      const nR = data.rates?.newRate || 10;
      const oR = data.rates?.oldRate || 8;
      document.getElementById('newRateLabel').innerText = `New: ${nR} ‡¶ü‡¶æ‡¶ï‡¶æ`;
      document.getElementById('oldRateLabel').innerText = `Old: ${oR} ‡¶ü‡¶æ‡¶ï‡¶æ`;
      document.getElementById('dollarType').innerHTML = `
        <option value="${nR}">New Gmail (${nR} ‡¶ü‡¶æ‡¶ï‡¶æ)</option>
        <option value="${oR}">Old Gmail (${oR} ‡¶ü‡¶æ‡¶ï‡¶æ)</option>
      `;
      updateTotal();

      document.getElementById('timerTextDisplay').innerText = data.timer_text || "Review Time: 1-12 Hours";
      document.getElementById('refPercentText').innerText = (data.referral_bonus || 5) + '%';

      const minW = data.min_withdraw || 100;
      document.getElementById('minWithdrawLabel').innerText = `üí∞ Minimum Withdrawal: ${minW} BDT`;
      document.getElementById('withdrawAmount').setAttribute('min', minW);
      document.getElementById('withdrawAmount').placeholder = `‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® (${minW}+)`;

      const broadcastMsg = data.broadcast || "";
      const box = document.getElementById('broadcastBox');
      const txt = document.getElementById('broadcastText');
      
      if(broadcastMsg) {
          txt.innerText = broadcastMsg;
          box.style.display = 'flex';
          
          const lastSeen = localStorage.getItem('last_broadcast_seen');
          if(lastSeen !== broadcastMsg) {
              Swal.fire({
                  title: 'üì¢ ‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶®‡ßã‡¶ü‡¶ø‡¶∂',
                  text: broadcastMsg,
                  confirmButtonText: '‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá',
                  allowOutsideClick: false
              }).then(() => {
                  localStorage.setItem('last_broadcast_seen', broadcastMsg);
              });
          }
      } else {
          box.style.display = 'none';
      }
    }
  });

  onValue(ref(db, "users"), (snap) => {
    const sellersList = document.getElementById('topSellersList');
    let htmlContent = '';
    const users = [];
    snap.forEach((child) => {
      const u = child.val();
      if (u.isTopSeller === true) users.push(u);
    });
    users.sort((a, b) => (Number(b.balance) || 0) - (Number(a.balance) || 0));
    users.forEach(u => {
      htmlContent += `
        <div class="card p-3 shadow-sm mb-2 border-0 d-flex flex-row justify-content-between align-items-center">
            <span><i class="bi bi-trophy-fill text-warning me-2"></i> <b>${u.username}</b></span>
            <span class="badge bg-success">‡ß≥ ${(Number(u.balance) || 0).toFixed(0)}</span>
        </div>`;
    });
    sellersList.innerHTML = htmlContent;
  });

  onAuthStateChanged(auth, (user) => {
    window.currentUser = user;
    if (user) {
        update(ref(db, 'users/' + user.uid), { last_login: Date.now() });

      onValue(ref(db, 'users/' + user.uid), (snap) => {
        if (snap.exists()) {
          const data = snap.val();
          document.getElementById('userDisplayName').innerText = data.username || "User";
          document.getElementById('mainBalance').innerText = (Number(data.balance) || 0).toFixed(2);
          document.getElementById('holdBalance').innerText = (Number(data.hold) || 0).toFixed(2);
          document.getElementById('myReferralCode').innerText = data.referralCode || "LOADING...";
          document.getElementById('referralEarnings').innerText = (Number(data.referralEarnings) || 0).toFixed(2);
          
          if (data.paymentNumber) document.getElementById('paymentNumber').value = data.paymentNumber;
          
          const payMethodBox = document.getElementById('savedPaymentMethodDisplay');
          if(data.paymentMethod) {
              payMethodBox.style.display = 'block';
              payMethodBox.innerText = `Saved Method: ${data.paymentMethod} (${data.paymentNumber})`;
          } else {
              payMethodBox.style.display = 'none';
          }

          // Admin Popup Message Logic
          if (data.admin_message && data.admin_message !== "") {
              const lastMsg = localStorage.getItem('last_admin_msg_' + user.uid);
              if (lastMsg !== data.admin_message) {
                  Swal.fire({
                      title: 'Admin Message',
                      text: data.admin_message,
                      confirmButtonText: 'OK'
                  }).then(() => {
                      localStorage.setItem('last_admin_msg_' + user.uid, data.admin_message);
                      update(ref(db, 'users/' + user.uid + '/admin_message'), ""); 
                  });
              }
          }
        }
      });

      const referralQuery = query(ref(db, 'users'), orderByChild('referredBy'), equalTo(user.uid));
      onValue(referralQuery, (snap) => {
          document.getElementById('totalReferred').innerText = snap.size;
      });

      const historyQuery = query(ref(db, 'submissions'), orderByChild('userId'), equalTo(user.uid));
      onValue(historyQuery, (snap) => {
          const list = document.getElementById('historyList');
          list.innerHTML = '';
          let hasData = false;
          let totalEmails = 0;
          let pendingCount = 0;
          let approvedCount = 0;
          let rejectedCount = 0;

          let submissions = [];
          snap.forEach(child => {
              const item = child.val();
              item.key = child.key;
              submissions.push(item);
          });
          submissions.sort((a, b) => b.submittedAt - a.submittedAt);

          submissions.forEach(item => {
              hasData = true;
              const date = new Date(item.submittedAt).toLocaleString();
              totalEmails += Number(item.count || 0);

              let detailsHTML = '';
              if(item.gmails && Array.isArray(item.gmails)){
                  item.gmails.forEach(g => {
                      let status = g.status || item.status || 'pending'; 
                      
                      if(status === 'pending') { pendingCount++; }
                      if(status === 'approved') { approvedCount++; }
                      if(status === 'rejected') { rejectedCount++; }

                      let badgeClass = 'bg-warning text-dark'; 
                      let badgeText = 'Pending';

                      if(status === 'approved') {
                          badgeClass = 'bg-success';
                          badgeText = 'Approved';
                      } else if(status === 'rejected') {
                          badgeClass = 'bg-danger';
                          badgeText = 'Rejected';
                      }

                      detailsHTML += `
                        <div class="d-flex justify-content-between align-items-center mt-1 p-1 rounded" style="background: #f8f9fa;">
                            <small class="text-truncate" style="max-width: 150px;" title="${g.email}">${g.email}</small>
                            <span class="badge ${badgeClass}">${badgeText}</span>
                        </div>
                      `;
                  });
              }

              list.innerHTML += `
                <li class="list-group-item history-list-item">
                    <div class="d-flex justify-content-between align-items-start">
                        <div class="fw-bold">‡ß≥ ${item.totalAmount} <small class="text-muted">(${item.count} Emails)</small></div>
                        <i class="bi bi-trash3 text-danger" onclick="deleteSubmission('${item.key}')" style="cursor:pointer;" title="Delete History"></i>
                    </div>
                    <div class="d-flex flex-column gap-1 mt-2">
                        ${detailsHTML}
                    </div>
                    <div class="text-muted small mt-1"><i class="bi bi-clock"></i> ${date}</div>
                </li>
              `;
          });

          document.getElementById('statTotal').innerText = totalEmails;
          document.getElementById('statPending').innerText = pendingCount;
          document.getElementById('statApproved').innerText = approvedCount;
          document.getElementById('statRejected').innerText = rejectedCount;

          if(!hasData) {
              list.innerHTML = '<li class="list-group-item text-center text-muted py-4">‡¶ï‡ßã‡¶®‡ßã ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</li>';
          }
      });

      document.getElementById('auth-page').style.display = 'none';
    } else {
        document.getElementById('historyList').innerHTML = '<li class="list-group-item text-center text-muted py-4">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá...</li>';
        document.getElementById('statTotal').innerText = "0";
        document.getElementById('statPending').innerText = "0";
        document.getElementById('statApproved').innerText = "0";
        document.getElementById('statRejected').innerText = "0";
    }
  });

  window.handleLogin = async () => {
    const email = document.getElementById('loginEmail').value.trim();
    const pass = document.getElementById('loginPass').value;
    try {
      await signInWithEmailAndPassword(auth, email, pass);
      switchTab('home');
    } catch (err) { Swal.fire("‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø", "‡¶≠‡ßÅ‡¶≤ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°", "error"); }
  };

  window.handleRegister = async () => {
    const name = document.getElementById('regName').value.trim();
    const email = document.getElementById('regEmail').value.trim();
    const pass = document.getElementById('regPass').value;
    const myRefCode = Math.random().toString(36).substring(2, 8).toUpperCase();
    
    if (!name || !email.endsWith('@gmail.com') || pass.length < 6) return alert("‡¶∏‡¶†‡¶ø‡¶ï ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®");
    try {
      const res = await createUserWithEmailAndPassword(auth, email, pass);
      await set(ref(db, 'users/' + res.user.uid), { 
          username: name, 
          email, 
          balance: 0, 
          hold: 0, 
          paymentNumber: "", 
          paymentMethod: "",
          createdAt: Date.now(),
          referralCode: myRefCode,
          referredBy: referrerCode || "",
          referralEarnings: 0,
          last_login: Date.now()
      });
      location.reload();
    } catch (err) { alert(err.message); }
  };

  window.handleLogout = () => signOut(auth).then(() => location.reload());

  window.submitGmails = async (submissionData) => {
    if (isNaN(submissionData.totalAmount) || submissionData.totalAmount <= 0) {
        return Swal.fire("‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø", "‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶∞‡ßá‡¶ü ‡¶≤‡ßã‡¶° ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡¶ø‡•§ ‡¶™‡ßá‡¶ú‡¶ü‡¶ø ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§", "error");
    }
    try {
      for (let item of submissionData.gmails) {
        const q = query(ref(db, 'used_emails'), orderByChild('email'), equalTo(item.email));
        const emailSnap = await get(q);
        if (emailSnap.exists()) return Swal.fire("‡¶è‡¶∞‡¶∞", `${item.email} ‡¶Ü‡¶ó‡ßá ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!`, "warning");
      }
      const newRef = push(ref(db, 'submissions'));
      await set(newRef, {
        userId: currentUser.uid,
        username: document.getElementById('userDisplayName').innerText,
        submittedAt: Date.now(),
        status: "pending",
        ...submissionData
      });
      for (let item of submissionData.gmails) {
        await push(ref(db, 'used_emails'), { email: item.email });
      }
      const userRef = ref(db, 'users/' + currentUser.uid);
      const userSnap = await get(userRef);
      const userData = userSnap.val();
      const currentHold = Number(userData.hold) || 0;
      await update(userRef, { hold: currentHold + submissionData.totalAmount });
      Swal.fire("‡¶∏‡¶´‡¶≤", "‡¶ï‡¶æ‡¶ú ‡¶ú‡¶Æ‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶è‡¶∞ ‡¶™‡¶∞ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏‡ßá ‡¶Ø‡ßã‡¶ó ‡¶π‡¶¨‡ßá‡•§", "success").then(() => location.reload());
    } catch (err) {
      if (err.message.includes("indexOn")) {
         Swal.fire("‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶ú ‡¶è‡¶∞‡¶∞", "Firebase Rules ‡¶è '.indexOn': 'email' ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§", "error");
      } else {
         Swal.fire("‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø", err.message, "error");
      }
    }
  };

  window.processWithdraw = async () => {
    const method = document.getElementById('withdrawMethod').value;
    const amt = Number(document.getElementById('withdrawAmount').value);
    const balance = Number(document.getElementById('mainBalance').innerText);
    const pNum = document.getElementById('paymentNumber').value.trim();
    
    const minW = Number(document.getElementById('withdrawAmount').getAttribute('min'));

    if (!method || isNaN(amt) || amt < minW) return Swal.fire("‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø", `‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ${minW} ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§`, "error");
    if (amt > balance) return Swal.fire("‡¶è‡¶∞‡¶∞", "‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏‡ßá ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶®‡ßá‡¶á", "error");
    if (!pNum) return Swal.fire("‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø", "‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®", "error");
    
    try {
      const newWithdrawRef = push(ref(db, 'withdraw_requests'));
      await set(newWithdrawRef, {
        userId: currentUser.uid,
        username: document.getElementById('userDisplayName').innerText,
        amount: amt,
        method: method,
        paymentNumber: pNum,
        status: "pending",
        requestedAt: Date.now()
      });
      const userRef = ref(db, 'users/' + currentUser.uid);
      await update(userRef, { balance: balance - amt });
      Swal.fire("‡¶∏‡¶´‡¶≤", "‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá!", "success").then(()=>location.reload());
    } catch (err) { Swal.fire("‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø", "‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá", "error"); }
  };

  window.savePaymentNumber = async () => {
    const num = document.getElementById('paymentNumber').value.trim();
    const method = document.getElementById('withdrawMethod').value; 
    
    const updates = { paymentNumber: num };
    if(method) updates.paymentMethod = method;

    if (num) {
      await update(ref(db, 'users/' + currentUser.uid), updates);
      Swal.fire("‡¶∏‡¶´‡¶≤", "‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá", "success");
    }
  };

  window.deleteSubmission = async (key) => {
      const result = await Swal.fire({
          title: 'Delete History?',
          text: "‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶è‡¶á ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶ü‡¶ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?",
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#d33',
          confirmButtonText: 'Yes, delete!'
      });

      if (result.isConfirmed) {
          await remove(ref(db, `submissions/${key}`));
          Swal.fire("Deleted", "History removed.", "success");
      }
  };

  // --- ‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶° ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ---
  window.copyRefLink = async () => {
      if (!window.currentUser) {
          return Swal.fire("Error", "‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§", "error");
      }

      const uid = window.currentUser.uid;
      const dbRef = ref(db, 'users/' + uid);
      
      try {
          const snap = await get(dbRef);
          if (!snap.exists()) {
              return Swal.fire("Error", "User data not found.", "error");
          }
          
          let data = snap.val();
          let code = data.referralCode;

          // ‡¶Ø‡¶¶‡¶ø ‡¶ï‡ßã‡¶° ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá, ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶° ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
          if (!code || code === "N/A" || code === "LOADING...") {
              const newCode = Math.random().toString(36).substring(2, 8).toUpperCase();
              
              // DB ‡¶§‡ßá ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
              await update(dbRef, { referralCode: newCode });
              
              // ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
              data.referralCode = newCode;
              
              // UI ‡¶§‡ßá ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá
              const codeEl = document.getElementById('myReferralCode');
              if(codeEl) codeEl.innerText = newCode;
              
              code = newCode;
          }

          // ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ
          const baseUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
          const link = baseUrl + "?ref=" + code;

          // ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ
          let success = false;
          if (navigator.clipboard && window.isSecureContext) {
              try {
                  await navigator.clipboard.writeText(link);
                  success = true;
              } catch (err) {
                  console.error('Failed to copy: ', err);
                  fallbackCopyTextToClipboard(link);
                  success = true; // Fallback worked
              }
          } else {
              fallbackCopyTextToClipboard(link);
              success = true;
          }

          if (success) {
              Swal.fire("Success!", "‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá!", "success");
          }

      } catch (error) {
          console.error("Error in copyRefLink:", error);
          Swal.fire("Error", "Something went wrong!", "error");
      }
  };

  function fallbackCopyTextToClipboard(text) {
      const dummy = document.createElement('textarea');
      document.body.appendChild(dummy);
      dummy.value = text;
      dummy.select();
      document.execCommand('copy');
      document.body.removeChild(dummy);
  }

</script>

<script>
    function updateClock() {
        const now = new Date();
        const timeString = now.toLocaleTimeString('bn-BD', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        const clockEl = document.getElementById('liveClock');
        if(clockEl) clockEl.innerText = timeString;
    }
    setInterval(updateClock, 1000);
    updateClock();

    function switchTab(tabId) {
        document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        const tabElement = document.getElementById(tabId);
        if (tabElement) tabElement.classList.add('active');
        const btn = document.getElementById(tabId + '-btn');
        if(btn) btn.classList.add('active');
    }

    function protectedAction(tabId) {
        if (!window.currentUser) document.getElementById('auth-page').style.display = 'block';
        else if (tabId === 'exchange') switchTab('exchange_step');
        else switchTab(tabId);
    }

    function addMoreRow(email='', pass='') {
        const row = document.createElement('div');
        row.className = 'gmail-row p-3 bg-white rounded border mb-2 row-item position-relative';
        row.innerHTML = `<input type="email" class="form-control mb-2 g-input" value="${email}" placeholder="Real Gmail Address" required>
            <input type="text" class="form-control p-input" value="${pass}" placeholder="Password" required>
            <span class="text-danger position-absolute top-0 end-0 p-1" style="cursor:pointer" onclick="this.parentElement.remove(); updateTotal();"><i class="bi bi-x-circle"></i></span>`;
        document.getElementById('gmailRows').appendChild(row);
        updateTotal();
    }

    function updateTotal() {
        const count = document.querySelectorAll('.gmail-row').length;
        const selectEl = document.getElementById('dollarType');
        const rate = selectEl ? Number(selectEl.value) : 0;
        const total = count * (isNaN(rate) ? 0 : rate);
        const totalEl = document.getElementById('tempTotal');
        if(totalEl) totalEl.innerText = total;
    }

    function validateAndSubmit() {
        const errorBox = document.getElementById('masterError');
        errorBox.style.display = 'none';
        const rows = document.querySelectorAll('.gmail-row');
        if (rows.length < 2) { errorBox.innerText = "‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß®‡¶ü‡¶ø ‡¶ú‡¶ø‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¶‡¶ø‡¶®!"; errorBox.style.display = 'block'; return; }

        const gmails = [];
        let hasError = false;
        const localSet = new Set();

        rows.forEach((row, idx) => {
            const email = row.querySelector('.g-input').value.trim().toLowerCase();
            const pass = row.querySelector('.p-input').value.trim();
            if (!email.endsWith("@gmail.com")) { hasError = true; errorBox.innerText = `${idx+1} ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶ú‡¶ø‡¶Æ‡ßá‡¶á‡¶≤ ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡ßü!`; }
            else if (localSet.has(email)) { hasError = true; errorBox.innerText = "‡¶è‡¶ï‡¶á ‡¶ú‡¶ø‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¶‡ßÅ‡¶¨‡¶æ‡¶∞ ‡¶¶‡¶ø‡ßü‡ßá‡¶õ‡ßá‡¶®!"; }
            else if (pass.length < 6) { hasError = true; errorBox.innerText = "‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶Ö‡¶®‡ßç‡¶§‡¶§ ‡¶¨ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞‡ßá‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá!"; }
            
            if (!hasError) { localSet.add(email); gmails.push({ email, password: pass }); }
        });

        if (!hasError) {
            const rate = Number(document.getElementById('dollarType').value);
            window.submitGmails({ gmails, totalAmount: gmails.length * rate, rate, count: gmails.length });
        } else { errorBox.style.display = 'block'; }
    }

    function toggleWithdraw() {
        const w = document.getElementById('withdrawArea');
        w.style.display = (w.style.display === "none") ? "block" : "none";
    }

    function toggleAuth(type) {
        document.getElementById('login-form').style.display = type === 'reg' ? 'none' : 'block';
        document.getElementById('reg-form').style.display = type === 'reg' ? 'block' : 'none';
    }
    function hideAuth() { document.getElementById('auth-page').style.display = 'none'; }
</script>

</body>
</html>